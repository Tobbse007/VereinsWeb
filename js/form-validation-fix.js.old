document.addEventListener('DOMContentLoaded', function() {
  // Referenz auf das ursprüngliche Formular und dessen Komponenten
  const multiStepForm = document.getElementById('multi-step-form');
  const formSteps = document.querySelectorAll('.form-step');
  const nextButtons = document.querySelectorAll('.next-step');
  const prevButtons = document.querySelectorAll('.prev-step');
  const progressBar = document.getElementById('progress-bar');
  const currentStepEl = document.getElementById('current-step');
  const totalStepsEl = document.getElementById('total-steps');
  const submitButton = document.querySelector('button[type="submit"]');
  
  // Aktuellen Schritt verfolgen
  let currentStep = 1;
  const totalSteps = formSteps.length;
  
  // Deaktiviere die ursprünglichen Event-Listener
  if (nextButtons) {
    nextButtons.forEach(button => {
      const newButton = button.cloneNode(true);
      button.parentNode.replaceChild(newButton, button);
    });
  }
  
  // Die aktualisierten Buttons neu auswählen
  const updatedNextButtons = document.querySelectorAll('.next-step');
  const updatedPrevButtons = document.querySelectorAll('.prev-step');
  
  // Event-Listener für "Weiter"-Buttons
  if (updatedNextButtons) {
    updatedNextButtons.forEach(button => {
      button.addEventListener('click', () => {
        if (validateCurrentStep()) {
          goToNextStep();
        }
      });
    });
  }
  
  // Event-Listener für "Zurück"-Buttons
  if (updatedPrevButtons) {
    updatedPrevButtons.forEach(button => {
      button.addEventListener('click', () => {
        goToPrevStep();
      });
    });
  }
  
  // Event-Listener für den Submit-Button
  if (submitButton && multiStepForm) {
    multiStepForm.addEventListener('submit', function(event) {
      event.preventDefault(); // Verhindere das standardmäßige Formular-Absenden
      
      if (validateCurrentStep()) {
        // Ändere den Button-Text zu einem Ladesymbol
        const originalButtonContent = submitButton.innerHTML;
        submitButton.disabled = true;
        submitButton.innerHTML = `
          <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <span>Wird gesendet...</span>
        `;
        
        // Simuliere eine Server-Anfrage (in einer realen Anwendung würde hier ein Fetch oder ähnliches stehen)
        setTimeout(function() {
          showSuccessMessage();
        }, 1500); // Zeige nach 1,5 Sekunden die Erfolgsmeldung an
      }
    });
  }
  
  // Zum nächsten Schritt gehen
  function goToNextStep() {
    const currentFormStep = document.querySelector(`.form-step[data-step="${currentStep}"]`);
    const nextFormStep = document.querySelector(`.form-step[data-step="${currentStep + 1}"]`);
    
    // Prüfe, ob wir den letzten Schritt erreicht haben
    if (currentStep < totalSteps) {
      // Aktuellen Schritt ausblenden
      currentFormStep.classList.add('hidden');
      
      // Nächsten Schritt einblenden
      nextFormStep.classList.remove('hidden');
      
      // Fortschritt aktualisieren
      currentStep++;
      updateProgressBar();
      
      // Nach oben scrollen zur Formularposition
      const formElement = document.getElementById('multi-step-form');
      const formSection = document.querySelector('.contact-section');
      const scrollTarget = formSection || formElement;
      
      if (scrollTarget) {
        const offset = scrollTarget.getBoundingClientRect().top + window.pageYOffset - 150;
        window.scrollTo({
          top: offset,
          behavior: 'smooth'
        });
      }
    } else {
      // Wenn wir beim letzten Schritt sind, das Formular absenden oder eine Erfolgsmeldung anzeigen
      showSuccessMessage();
    }
  }
  
  // Zum vorherigen Schritt gehen
  function goToPrevStep() {
    const currentFormStep = document.querySelector(`.form-step[data-step="${currentStep}"]`);
    const prevFormStep = document.querySelector(`.form-step[data-step="${currentStep - 1}"]`);
    
    if (currentStep > 1) {
      // Aktuellen Schritt ausblenden
      currentFormStep.classList.add('hidden');
      
      // Vorherigen Schritt einblenden
      prevFormStep.classList.remove('hidden');
      
      // Fortschritt aktualisieren
      currentStep--;
      updateProgressBar();
      
      // Nach oben scrollen zur Formularposition
      const formElement = document.getElementById('multi-step-form');
      const formSection = document.querySelector('.contact-section');
      const scrollTarget = formSection || formElement;
      
      if (scrollTarget) {
        const offset = scrollTarget.getBoundingClientRect().top + window.pageYOffset - 150;
        window.scrollTo({
          top: offset,
          behavior: 'smooth'
        });
      }
    }
  }
  
  // Fortschrittsbalken aktualisieren
  function updateProgressBar() {
    const progressPercentage = ((currentStep - 1) / (totalSteps - 1)) * 100;
    if (progressBar) progressBar.style.width = `${progressPercentage}%`;
    if (currentStepEl) currentStepEl.textContent = currentStep;
  }
  
  // Validieren des aktuellen Schritts
  function validateCurrentStep() {
    const currentFormStep = document.querySelector(`.form-step[data-step="${currentStep}"]`);
    let isValid = true;
    
    // Prüfe alle required Felder im aktuellen Schritt
    const requiredFields = currentFormStep.querySelectorAll('[required]');
    requiredFields.forEach(field => {
      if (!field.value.trim() || (field.type === 'checkbox' && !field.checked)) {
        isValid = false;
        showError(field, field.type === 'checkbox' 
                 ? 'Bitte stimmen Sie zu, um fortzufahren' 
                 : 'Dieses Feld ist erforderlich');
      } else {
        clearError(field);
      }
    });
    
    // E-Mail Validierung für Schritt 1
    if (currentStep === 1) {
      const emailInput = document.getElementById('email');
      if (emailInput && emailInput.value.trim()) {
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailPattern.test(emailInput.value)) {
          showError(emailInput, 'Bitte geben Sie eine gültige E-Mail-Adresse ein');
          isValid = false;
        }
      }
    }
    
    // Spezielle Validierung für Schritt 2 (Über Ihren Verein)
    if (currentStep === 2) {
      // Prüfe, ob mindestens ein Radio-Button für Vereinsart ausgewählt ist
      const vereinsartContainer = currentFormStep.querySelector('#vereinsart-container');
      const vereinsartErrorContainer = currentFormStep.querySelector('#vereinsart-error-container');
      const vereinsartRadios = currentFormStep.querySelectorAll('.vereinsart-radio');
      const isAnyRadioChecked = Array.from(vereinsartRadios).some(radio => radio.checked);
      
      if (!isAnyRadioChecked) {
        isValid = false;
        
        // Spezielle Behandlung für die Fehlermeldung der Vereinsart
        clearError(vereinsartErrorContainer);
        const errorElement = document.createElement('p');
        errorElement.className = 'text-red-500 text-sm error-message';
        errorElement.textContent = 'Bitte wählen Sie eine Art des Vereins aus';
        vereinsartErrorContainer.appendChild(errorElement);
        vereinsartContainer.classList.add('has-error');
      } else {
        clearError(vereinsartErrorContainer);
        vereinsartContainer.classList.remove('has-error');
      }
      
      // Prüfe, ob bei "Andere Vereinsart" ein Text eingegeben wurde
      const andereVereinartRadio = currentFormStep.querySelector('input[name="vereinsart"][value="andere"]');
      const andereVereinartText = document.getElementById('andere-vereinsart-text');
      
      if (andereVereinartRadio && andereVereinartRadio.checked) {
        if (!andereVereinartText.value.trim()) {
          isValid = false;
          showError(andereVereinartText, 'Bitte beschreiben Sie Ihre Vereinsart');
        } else {
          clearError(andereVereinartText);
        }
      }
    }
    
    // Spezielle Validierung für Schritt 3 (Website Anforderungen)
    if (currentStep === 3) {
      // Prüfe, ob mindestens eine Website-Ziel-Checkbox ausgewählt ist
      const websiteZielContainer = currentFormStep.querySelector('#website-ziele-container');
      const websiteZielErrorContainer = currentFormStep.querySelector('#website-ziele-error-container');
      const websiteZielCheckboxes = currentFormStep.querySelectorAll('.website-ziel-checkbox');
      const isAnyCheckboxChecked = Array.from(websiteZielCheckboxes).some(checkbox => checkbox.checked);
      
      if (!isAnyCheckboxChecked) {
        isValid = false;
        
        // Spezielle Behandlung für die Fehlermeldung der Website-Ziele
        clearError(websiteZielErrorContainer);
        const errorElement = document.createElement('p');
        errorElement.className = 'text-red-500 text-sm error-message';
        errorElement.textContent = 'Bitte wählen Sie mindestens ein Ziel für Ihre Website aus';
        websiteZielErrorContainer.appendChild(errorElement);
        websiteZielContainer.classList.add('has-error');
      } else {
        clearError(websiteZielErrorContainer);
        websiteZielContainer.classList.remove('has-error');
      }
        // Prüfe, ob bei "Andere Anforderungen" ein Text eingegeben wurde
      const andereAnforderungenCheckbox = currentFormStep.querySelector('#andere-anforderungen-checkbox');
      const andereAnforderungenText = currentFormStep.querySelector('#andere-anforderungen-text');
      
      if (andereAnforderungenCheckbox && andereAnforderungenCheckbox.checked) {
        if (!andereAnforderungenText.value.trim()) {
          isValid = false;
            // Entferne alte Fehlermeldungen, um doppelte zu vermeiden
          const errorContainer = document.getElementById('andere-anforderungen-text-error-container');
          if (errorContainer) {
            errorContainer.innerHTML = '';
            // Erstelle eine klare, einfache Fehlermeldung
            const errorElement = document.createElement('p');
            errorElement.className = 'text-red-500 text-sm error-message';
            errorElement.textContent = 'Bitte beschreiben Sie Ihre spezifischen Anforderungen';
            errorContainer.appendChild(errorElement);
          }
          
          // Markiere das Feld als fehlerhaft, aber ohne zusätzliche Fehlermeldung
          andereAnforderungenText.classList.add('validation-failed', 'border-red-500');
        } else {
          clearError(andereAnforderungenText);
        }
      }
      
      // Prüfe, ob eine Option für "Vorhandene Website" ausgewählt wurde
      const vorhandeneWebsiteContainer = currentFormStep.querySelector('#vorhandene-website-container');
      const vorhandeneWebsiteErrorContainer = currentFormStep.querySelector('#vorhandene-website-error-container');
      const vorhandeneWebsiteRadios = currentFormStep.querySelectorAll('.vorhandene-website-radio');
      const isAnyVorhandeneWebsiteChecked = Array.from(vorhandeneWebsiteRadios).some(radio => radio.checked);
      
      if (!isAnyVorhandeneWebsiteChecked) {
        isValid = false;
        
        // Spezielle Behandlung für die Fehlermeldung der vorhandenen Website
        clearError(vorhandeneWebsiteErrorContainer);
        const errorElement = document.createElement('p');
        errorElement.className = 'text-red-500 text-sm error-message';
        errorElement.textContent = 'Bitte geben Sie an, ob Ihr Verein bereits eine Website hat';
        vorhandeneWebsiteErrorContainer.appendChild(errorElement);
        vorhandeneWebsiteContainer.classList.add('has-error');
      } else {
        clearError(vorhandeneWebsiteErrorContainer);
        vorhandeneWebsiteContainer.classList.remove('has-error');
      }
      
      // Prüfe, ob bei "Ja" zur vorhandenen Website eine URL eingegeben wurde
      const jaVorhandeneWebsiteRadio = currentFormStep.querySelector('input[name="vorhandene_website"][value="ja"]');
      const websiteUrlInput = document.getElementById('website-url');
      const websiteUrlErrorContainer = document.getElementById('website-url-error-container');
      
      if (jaVorhandeneWebsiteRadio && jaVorhandeneWebsiteRadio.checked && websiteUrlInput) {
        if (!websiteUrlInput.value.trim()) {
          isValid = false;
          
          // Spezielle Behandlung für die Fehlermeldung der Website-URL
          clearError(websiteUrlErrorContainer);
          const errorElement = document.createElement('p');
          errorElement.className = 'text-red-500 text-sm error-message';
          errorElement.textContent = 'Bitte geben Sie die URL Ihrer aktuellen Website ein';
          websiteUrlErrorContainer.appendChild(errorElement);
        } else {
          clearError(websiteUrlErrorContainer);
        }
      }
    }
    
    // Spezielle Validierung für Schritt 4 (Design und Funktionen)
    if (currentStep === 4) {
      // Prüfe, ob eine Option für Vereinsfarben ausgewählt wurde
      const vereinsfarbenContainer = currentFormStep.querySelector('#vereinsfarben-container');
      const vereinsfarbenErrorContainer = currentFormStep.querySelector('#vereinsfarben-error-container');
      const vereinsfarbenRadios = currentFormStep.querySelectorAll('.vereinsfarben-radio');
      const isAnyVereinsfarbenChecked = Array.from(vereinsfarbenRadios).some(radio => radio.checked);
      
      if (!isAnyVereinsfarbenChecked) {
        isValid = false;
        
        // Spezielle Behandlung für die Fehlermeldung der Vereinsfarben
        clearError(vereinsfarbenErrorContainer);
        const errorElement = document.createElement('p');
        errorElement.className = 'text-red-500 text-sm error-message';
        errorElement.textContent = 'Bitte geben Sie an, ob Sie Vereinsfarben haben';
        vereinsfarbenErrorContainer.appendChild(errorElement);
        vereinsfarbenContainer.classList.add('has-error');
      } else {
        clearError(vereinsfarbenErrorContainer);
        vereinsfarbenContainer.classList.remove('has-error');
      }
        // Prüfe, ob bei "Ja" zu Vereinsfarben die Farben angegeben wurden
      const jaVereinsfarbenRadio = currentFormStep.querySelector('input[name="vereinsfarben"][value="ja"]');
      const vereinsfarbenTextInput = document.getElementById('farben-beschreibung');
      
      if (jaVereinsfarbenRadio && jaVereinsfarbenRadio.checked && vereinsfarbenTextInput) {
        if (!vereinsfarbenTextInput.value.trim()) {
          isValid = false;
          showError(vereinsfarbenTextInput, 'Bitte beschreiben Sie Ihre Vereinsfarben');
        } else {
          clearError(vereinsfarbenTextInput);
        }
      }// Prüfe, ob mindestens eine Funktions-Checkbox ausgewählt ist
      const funktionenContainer = currentFormStep.querySelector('#funktionen-container');
      const funktionenErrorContainer = currentFormStep.querySelector('#funktionen-error-container');
      const funktionCheckboxes = currentFormStep.querySelectorAll('.funktionen-checkbox');
      const isAnyFunktionChecked = Array.from(funktionCheckboxes).some(checkbox => checkbox.checked);
      
      // Entferne zunächst alle alten Fehlermeldungen
      if (funktionenErrorContainer) {
        funktionenErrorContainer.innerHTML = '';
      }
      
      if (!isAnyFunktionChecked) {
        isValid = false;
        
        // Spezielle Behandlung für die Fehlermeldung der Funktionen
        if (funktionenErrorContainer) {
          const errorElement = document.createElement('p');
          errorElement.className = 'text-red-500 text-sm error-message';
          errorElement.textContent = 'Bitte wählen Sie mindestens eine gewünschte Funktion aus';
          funktionenErrorContainer.appendChild(errorElement);
          if (funktionenContainer) {
            funktionenContainer.classList.add('has-error');
          }
        }
      } else {
        if (funktionenContainer) {
          funktionenContainer.classList.remove('has-error');
        }
      }
        // Prüfe, ob bei "Andere Funktionen" ein Text eingegeben wurde
      const andereFunktionenCheckbox = currentFormStep.querySelector('#andere-funktionen-checkbox');
      const andereFunktionenText = currentFormStep.querySelector('#andere-funktionen-text');
      
      if (andereFunktionenCheckbox && andereFunktionenCheckbox.checked && andereFunktionenText) {        if (!andereFunktionenText.value.trim()) {
          isValid = false;
          
          // Entferne alte Fehlermeldungen, um doppelte zu vermeiden
          const errorContainer = document.getElementById('andere-funktionen-text-error-container');
          if (errorContainer) {
            errorContainer.innerHTML = '';
            // Erstelle eine klare, einfache Fehlermeldung
            const errorElement = document.createElement('p');
            errorElement.className = 'text-red-500 text-sm error-message';
            errorElement.textContent = 'Bitte beschreiben Sie die gewünschten Funktionen';
            errorContainer.appendChild(errorElement);
          }
          
          // Markiere das Feld als fehlerhaft, aber ohne zusätzliche Fehlermeldung
          andereFunktionenText.classList.add('validation-failed', 'border-red-500');
        } else {
          clearError(andereFunktionenText);
        }      }
    }
    
    // Spezielle Validierung für Schritt 5 (Abschluss)
    if (currentStep === 5) {
      // Validierung für Datenschutz-Checkbox
      const datenschutzCheckbox = document.getElementById('datenschutz');
      if (datenschutzCheckbox && !datenschutzCheckbox.checked) {
        isValid = false;
        
        // Zeige Fehlermeldung für Datenschutz
        const errorContainer = datenschutzCheckbox.parentElement.querySelector('.error-container');
        if (!errorContainer) {
          // Wenn kein Fehlercontainer existiert, erstelle einen nach der Checkbox
          const newErrorContainer = document.createElement('div');
          newErrorContainer.className = 'mt-1 error-container';
          datenschutzCheckbox.parentElement.appendChild(newErrorContainer);
          
          const errorElement = document.createElement('p');
          errorElement.className = 'text-red-500 text-sm error-message';
          errorElement.textContent = 'Bitte stimmen Sie den Datenschutzbestimmungen zu';
          newErrorContainer.appendChild(errorElement);
        } else {
          clearError(errorContainer);
          const errorElement = document.createElement('p');
          errorElement.className = 'text-red-500 text-sm error-message';
          errorElement.textContent = 'Bitte stimmen Sie den Datenschutzbestimmungen zu';
          errorContainer.appendChild(errorElement);
        }
        
        // Visuelle Hervorhebung für die Checkbox
        datenschutzCheckbox.classList.add('border-red-500', 'ring-1', 'ring-red-500');
      } else if (datenschutzCheckbox) {
        // Entferne visuelle Hervorhebung
        datenschutzCheckbox.classList.remove('border-red-500', 'ring-1', 'ring-red-500');
        
        // Entferne Fehlermeldung wenn vorhanden
        const errorContainer = datenschutzCheckbox.parentElement.querySelector('.error-container');
        if (errorContainer) {
          clearError(errorContainer);
        }
      }
    }
    
    return isValid;
  }
  
  // Fehlermeldung anzeigen
  function showError(field, message) {
    // Füge Fehlerklasse hinzu
    field.classList.add('validation-failed');
    
    // Für Input-Felder
    if (field.tagName === 'INPUT' || field.tagName === 'TEXTAREA' || field.tagName === 'SELECT') {
      field.classList.add('border-red-500');
      
      // Suche nach dem Fehlercontainer
      let errorContainer;
      const fieldId = field.id;
      if (fieldId) {
        errorContainer = document.getElementById(fieldId + '-error-container');
      }
      
      // Wenn kein spezifischer Fehlercontainer gefunden wird, suche nach einem allgemeinen
      if (!errorContainer) {
        errorContainer = field.nextElementSibling;
        if (errorContainer && !errorContainer.classList.contains('mt-1')) {
          errorContainer = null;
        }
      }
      
      // Wenn immer noch kein Fehlercontainer gefunden wurde, füge die Fehlermeldung direkt nach dem Feld ein
      if (errorContainer) {
        // Lösche zuerst vorhandene Fehlermeldungen, um Duplikate zu vermeiden
        errorContainer.innerHTML = '';
        
        const errorElement = document.createElement('p');
        errorElement.className = 'text-red-500 text-sm error-message';
        errorElement.textContent = message;
        errorContainer.appendChild(errorElement);
      } else {
        // Fallback: Füge die Fehlermeldung direkt nach dem Feld ein
        const errorElement = document.createElement('p');
        errorElement.className = 'text-red-500 text-sm mt-1 error-message';
        errorElement.textContent = message;
        
        // Entferne vorhandene Fehlermeldungen
        const existingErrors = field.parentElement.querySelectorAll('.error-message');
        existingErrors.forEach(error => error.remove());
        
        field.parentElement.appendChild(errorElement);
      }
    } 
    // Für Container (z.B. Radio-Buttons, Checkboxen)
    else {
      field.classList.add('has-error');
    }
  }
  
  // Fehlermeldungen entfernen
  function clearError(field) {
    if (!field) return;
    
    // Wenn es ein Error-Container ist
    if (field.classList.contains('mt-1') || (field.id && field.id.includes('error-container'))) {
      // Alle Fehlermeldungen entfernen
      const errorMessages = field.querySelectorAll('.error-message');
      errorMessages.forEach(msg => msg.remove());
    } 
    // Wenn es ein Formularfeld ist
    else if (field.tagName) {
      field.classList.remove('border-red-500');
      field.classList.remove('validation-failed');
      
      // Suche auch nach dem zugehörigen Fehlercontainer
      const fieldId = field.id;
      if (fieldId) {
        const errorContainer = document.getElementById(fieldId + '-error-container');
        if (errorContainer) {
          const errorMessages = errorContainer.querySelectorAll('.error-message');
          errorMessages.forEach(msg => msg.remove());
        }
      }
    } else {
      field.classList.remove('has-error');
      field.classList.remove('validation-failed');
    }
  }
  
  // Erfolgsmeldung anzeigen  function showSuccessMessage() {
    // Formular ausblenden und Scrollposition merken
    const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
    multiStepForm.style.display = 'none';
    
    // Container für die Erfolgsmeldung
    const formContainer = document.querySelector('.glass.rounded-2xl');
    
    // Erfolgsmeldung erstellen
    const successMessage = document.createElement('div');
    successMessage.className = 'py-8 px-8 success-message';
    successMessage.innerHTML = `
      <div class="text-center">
        <div class="bg-green-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-6 animate-pulse">
          <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <h3 class="text-2xl font-bold mb-4 text-gray-800">Vielen Dank für Ihre Anfrage!</h3>
        <p class="text-gray-600 mb-6">Wir haben alle Informationen erhalten und werden Ihren kostenlosen Erstentwurf erstellen. Sie hören innerhalb der nächsten 24-48 Stunden von uns.</p>
        
        <div class="p-6 bg-primary-50 rounded-xl border border-primary-100 mb-6">
          <h4 class="font-semibold text-primary-700 mb-2">Ihre nächsten Schritte:</h4>
          <ol class="text-left space-y-3 text-gray-700">
            <li class="flex items-start">
              <span class="flex-shrink-0 bg-primary-100 w-6 h-6 rounded-full flex items-center justify-center text-primary-700 font-bold mr-2">1</span>
              <span>Wir erstellen Ihren kostenlosen Erstentwurf basierend auf Ihren Angaben.</span>
            </li>
            <li class="flex items-start">
              <span class="flex-shrink-0 bg-primary-100 w-6 h-6 rounded-full flex items-center justify-center text-primary-700 font-bold mr-2">2</span>
              <span>Sie erhalten eine E-Mail mit dem Zugang zu Ihrem Erstentwurf.</span>
            </li>
            <li class="flex items-start">
              <span class="flex-shrink-0 bg-primary-100 w-6 h-6 rounded-full flex items-center justify-center text-primary-700 font-bold mr-2">3</span>
              <span>Gemeinsam besprechen wir mögliche Anpassungen und das weitere Vorgehen.</span>
            </li>
          </ol>
        </div>
        
        <a href="index.html" class="inline-block px-6 py-3 bg-gradient-to-r from-primary-600 to-primary-700 text-white font-medium rounded-lg shadow-md hover:shadow-lg transform transition-all duration-300 hover:-translate-y-0.5">
          Zurück zur Startseite
        </a>
      </div>
    `;
    
    // Fortschrittsanzeige ausblenden
    const progressContainer = formContainer.querySelector('.bg-white.border-b');
    if (progressContainer) {
      progressContainer.style.display = 'none';
    }
    
    // Formularcontainer leeren und Erfolgsmeldung einfügen
    const formContent = formContainer.querySelector('.p-8');
    formContent.innerHTML = '';
    formContent.appendChild(successMessage);
    
    // Erhalte die Scrollposition bei
    window.scrollTo({
      top: scrollPosition,
      behavior: 'smooth'
    });
      // Verhindere, dass das Formular zurückgesetzt wird
    localStorage.setItem('formSubmitted', 'true');
  }
  }
  
  // Setup von abhängigen Feldern (gleiche Funktionalität wie in kontakt.js)
  setupDependentFields();
  
  function setupDependentFields() {
    // Für Vereinsart "Andere"
    const vereinsartRadios = document.querySelectorAll('input[name="vereinsart"]');
    const andereVereinartField = document.getElementById('andere-vereinsart');
    const andereVereinartText = document.getElementById('andere-vereinsart-text');
    
    if (vereinsartRadios.length > 0 && andereVereinartField) {
      vereinsartRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'andere' && this.checked) {
            andereVereinartField.classList.remove('hidden');
            // Wenn "Andere" ausgewählt wird, setze required für das Textfeld
            if (andereVereinartText) andereVereinartText.setAttribute('required', '');
          } else {
            andereVereinartField.classList.add('hidden');
            // Wenn eine andere Option ausgewählt wird, entferne required
            if (andereVereinartText) andereVereinartText.removeAttribute('required');
          }
        });
      });
    }
    
    // Für Andere Anforderungen
    const andereAnforderungenCheckbox = document.getElementById('andere-anforderungen-checkbox');
    const andereAnforderungenFeld = document.getElementById('andere-anforderungen-feld');
    const andereAnforderungenText = document.getElementById('andere-anforderungen-text');
    
    if (andereAnforderungenCheckbox && andereAnforderungenFeld) {
      andereAnforderungenCheckbox.addEventListener('change', function() {
        if (this.checked) {
          andereAnforderungenFeld.classList.remove('hidden');
          // Wenn die Checkbox ausgewählt wird, setze required für das Textfeld
          if (andereAnforderungenText) andereAnforderungenText.setAttribute('required', '');
        } else {
          andereAnforderungenFeld.classList.add('hidden');
          // Wenn die Checkbox nicht ausgewählt ist, entferne required
          if (andereAnforderungenText) andereAnforderungenText.removeAttribute('required');
        }
      });
    }
    
    // Für vorhandene Website
    const vorhandeneWebsiteRadios = document.querySelectorAll('input[name="vorhandene_website"]');
    const bestehendeWebsiteUrl = document.getElementById('bestehende-website-url');
    const websiteUrlInput = document.getElementById('website-url');
    
    if (vorhandeneWebsiteRadios.length > 0 && bestehendeWebsiteUrl) {
      vorhandeneWebsiteRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'ja' && this.checked) {
            bestehendeWebsiteUrl.classList.remove('hidden');
            // Wenn "Ja" ausgewählt wird, setze required für das URL-Feld
            if (websiteUrlInput) websiteUrlInput.setAttribute('required', '');
          } else {
            bestehendeWebsiteUrl.classList.add('hidden');
            // Wenn "Nein" ausgewählt wird, entferne required
            if (websiteUrlInput) websiteUrlInput.removeAttribute('required');
          }
        });
      });
    }
      // Für Vereinsfarben
    const vereinsfarbenRadios = document.querySelectorAll('input[name="vereinsfarben"]');
    const vereinsfarbenDetails = document.getElementById('vereinsfarben-details');
    const vereinsfarbenTextInput = document.getElementById('farben-beschreibung');
    
    if (vereinsfarbenRadios.length > 0 && vereinsfarbenDetails) {
      vereinsfarbenRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'ja' && this.checked) {
            vereinsfarbenDetails.classList.remove('hidden');
            // Wenn "Ja" ausgewählt wird, setze required für das Textfeld
            if (vereinsfarbenTextInput) vereinsfarbenTextInput.setAttribute('required', '');
          } else {
            vereinsfarbenDetails.classList.add('hidden');
            // Wenn "Nein" ausgewählt wird, entferne required
            if (vereinsfarbenTextInput) vereinsfarbenTextInput.removeAttribute('required');
          }
        });
      });
    }
    
    // Für andere Funktionen
    const andereFunktionenCheckbox = document.getElementById('andere-funktionen-checkbox');
    const andereFunktionenFeld = document.getElementById('andere-funktionen-feld');
    const andereFunktionenText = document.getElementById('andere-funktionen-text');
    
    if (andereFunktionenCheckbox && andereFunktionenFeld) {
      andereFunktionenCheckbox.addEventListener('change', function() {
        if (this.checked) {
          andereFunktionenFeld.classList.remove('hidden');
          // Wenn die Checkbox ausgewählt wird, setze required für das Textfeld
          if (andereFunktionenText) andereFunktionenText.setAttribute('required', '');
        } else {
          andereFunktionenFeld.classList.add('hidden');
          // Wenn die Checkbox nicht ausgewählt ist, entferne required
          if (andereFunktionenText) andereFunktionenText.removeAttribute('required');
        }
      });
    }
  }
});
